<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="color-scheme" content="light only" />
    <meta name="supported-color-schemes" content="light" />
    <title>오늘도골대FC</title>
    <link rel="apple-touch-icon" sizes="180x180"
        href="https://ik.imagekit.io/wlalafg7g/GoalPostAgain/logo.png?updatedAt=1700484789437">
    <link rel="icon" type="image/png" sizes="192x192"
        href="https://ik.imagekit.io/wlalafg7g/GoalPostAgain/logo.png?updatedAt=1700484789437">
    <link rel="icon" type="image/png" sizes="512x512"
        href="https://ik.imagekit.io/wlalafg7g/GoalPostAgain/logo.png?updatedAt=1700484789437">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link href="/main.css" rel="stylesheet">
    <link href="/story.css" rel="stylesheet">
    <link href="/story-photo.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Hi+Melody&family=Noto+Sans+KR:wght@200;300;400;500;600&display=swap"
        rel="stylesheet">
    <script src="/main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
        crossorigin="anonymous"></script>
    <script>

        document.addEventListener('DOMContentLoaded', function () {
            var myCarousel = new bootstrap.Carousel(document.querySelector('#carouselExampleIndicators'), {
                interval: false, // 자동 슬라이드 비활성화
                touch: true // 터치로 스와이프 활성화
            });
        });

        function openInputComment(index) {
            var expanded = document.getElementById("story-photo-add-comment-input-area0" + index);

            if (expanded.style.display === "none") {
                expanded.style.display = "block";
            } else {
                expanded.style.display = "none"
            }

        }

        function EditPhoto(event) {


            var editId = event.target.getAttribute('data-photo-id');
            window.location.href = '/photo-edit/' + editId; // 혹은 fetch 등의 비동기 처리

        }



        function confirmDeletePhoto(event) {
            event.preventDefault();

            var commentId = event.target.getAttribute('data-photo-id');
            var confirmDelete = confirm('글을 삭제하시겠습니까?');

            if (confirmDelete) {
                window.location.href = '/photo-delete/' + commentId; // 혹은 fetch 등의 비동기 처리
            }
        }

        function confirmDeletePhotoComment(event) {
            event.preventDefault();

            var commentId = event.target.getAttribute('data-comment-id');
            var confirmDelete = confirm('댓글을 삭제하시겠습니까?');

            if (confirmDelete) {
                window.location.href = '/photo-comment-delete/' + commentId; // 혹은 fetch 등의 비동기 처리
            }
        }



        document.addEventListener('DOMContentLoaded', function () {
            // 모든 캐러셀 요소를 가져와서 반복
            var carousels = document.querySelectorAll('.carousel');
            carousels.forEach(function (carousel) {
                // 부트스트랩 캐러셀 초기화
                new bootstrap.Carousel(carousel, {
                    interval: false  // 자동 슬라이드를 비활성화하려면 이 부분을 추가합니다.
                });
            });
        });




    </script>




</head>

<body>
    <%- include('nav.ejs') %>

        <div class="story-main">


            <div class="story-bt-area">
                <div onclick="gotoPhoto()" class="story-photo-bt">PHOTO</div>
                <div onclick="gotoVideo()" class="story-video-bt">VIDEO</div>
            </div>
            <div class="story-photo-post"><a href="/photo-post">작성하기</a></div>
            <hr>

            <%for (i=0; i<포토.length; i++) {%>

                <div class="story-photo-area">


                    <div id="carouselExampleIndicators<%= i %>" class="carousel slide">
                        <div class="carousel-indicators">
                            <button type="button" data-bs-target="#carouselExampleIndicators<%= i %>"
                                data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                            <% if (포토[i].img[1] !=undefined) { %>
                                <% for (j=1; j < 포토[i].img.length; j++) { %>
                                    <button type="button" data-bs-target="#carouselExampleIndicators<%= i %>"
                                        data-bs-slide-to="<%= j %>" aria-label="Slide <%= j + 1 %>"></button>
                                    <% } %>
                                        <% } %>
                        </div>
                        <div class="carousel-inner">
                            <% if (포토[i].img[1]===undefined) { %>
                                <div class="carousel-item active">
                                    <img class="carousel-img d-block" src="<%= 포토[i].img[0].location %>" alt="...">
                                </div>
                                <% } else { %>
                                    <div class="carousel-item active">
                                        <img class="carousel-img d-block" src="<%= 포토[i].img[0].location %>" alt="...">
                                    </div>
                                    <% for (k=1; k < 포토[i].img.length; k++) { %>
                                        <div class="carousel-item">
                                            <img class="carousel-img d-block" src="<%= 포토[i].img[k].location %>"
                                                alt="...">
                                        </div>
                                        <% } %>
                                            <% } %>
                        </div>
                        <% if (포토[i].img[1] !=undefined) { %>
                            <button class="carousel-control-prev" type="button"
                                data-bs-target="#carouselExampleIndicators<%= i %>" data-bs-slide="prev">
                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Previous</span>
                            </button>
                            <button class="carousel-control-next" type="button"
                                data-bs-target="#carouselExampleIndicators<%= i %>" data-bs-slide="next">
                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                <span class="visually-hidden">Next</span>
                            </button>
                            <% } %>
                    </div>
                    <div class="story-photo-info-area">
                        <div class="story-photo-info">
                            <%=포토[i].time%>
                        </div>
                        <% if (유저==포토[i].username || 유저=='관리자' ) {%>
                            <div class="story-photo-edit">
                                <a href="#" data-photo-id="<%= 포토[i]._id%>" onclick="EditPhoto(event)"
                                    style="margin-right: 5px; cursor: pointer;">수정</a>
                                <a href="#" data-photo-id="<%= 포토[i]._id%>" onclick="confirmDeletePhoto(event)">삭제</a>
                            </div>
                            <%}%>
                    </div>

                    <div style="text-align: left;">
                        <div class="story-photo-content">

                            <p class="story-photo-content-writer">
                                <strong>
                                    <%=포토[i].username%>
                                </strong>
                            </p>
                            <span class="story-photo-content-text">
                                <%=포토[i].content%>
                            </span>

                        </div>



                        <div onclick="openInputComment('<%= i %>')" class="story-photo-add-comment">
                            댓글달기...
                        </div>

                        <script>
                            function PostPhotoComment<%= i %>(event) {
                                event.preventDefault();
                                var commentInput = document.getElementById('story-photo-add-comment-input<%= i %>');
                                var commentId = commentInput.value;

                                if (commentId == '') {
                                    alert('댓글을 입력하세요')
                                } else {
                                    var form = commentInput.closest('form');
                                    form.submit();
                                }
                            }
                        </script>

                        <form action="/photo-comment" method="POST">
                            <input name="parentId" value="<%= 포토[i]._id%>" style="display: none;">

                            <div id="story-photo-add-comment-input-area0<%= i %>" style="display: none;">
                                <div id="story-photo-add-comment-input-area" class="story-photo-add-comment-input-area">
                                    <input id="story-photo-add-comment-input<%= i %>" name="content"
                                        class="story-photo-add-comment-input" type="text" autocomplete="off">
                                    <button type="submit" class="story-photo-add-comment-inputBt"
                                        onclick="PostPhotoComment<%= i %>(event)">게시</button>
                                </div>
                            </div>
                        </form>



                        <% if (typeof 포토[i].comments !=='undefined' ) {%>
                            <% for (let comment of 포토[i].comments) { %>
                                <div style="display: flex; align-items: baseline;">
                                    <div class="story-photo-comment-writer">
                                        <strong>
                                            <%=comment.writer%>
                                        </strong>
                                    </div>
                                    <span class="story-photo-comment-text">
                                        <%=comment.content%>
                                    </span>
                                    <% if (유저==comment.writer || 유저=='관리자' ) {%>
                                        <a href="#" class="story-photo-comment-deleteBt"
                                            data-comment-id="<%= comment._id%>"
                                            onclick="confirmDeletePhotoComment(event)">X</a>

                                        <%}%>
                                </div>
                                <% } %>
                                    <% } %>


                                        <!-- <div class="story-photo-add-comment">
                            댓글 모두보기
                        </div> -->

                                        <hr>

                                        <%}%>
                    </div>
                </div>





        </div>


</body>

</html>